# 関数の基本

## イントロダクション - コードの部品化から変数スコープ

この技術資料へようこそ。ここでは、C言語における「関数（Function）」について、その基本から応用までを網羅的に解説します。関数は、単なるコードを記述するための構文ではありません。それは、複雑な問題を整理し、再利用可能で、保守性の高いプログラムを構築するための根幹をなす設計思想そのものです。プログラムを学び始めた皆さんにとって、このガイドは単に文法を学ぶだけでなく、優れたソフトウェア設計者としての第一歩を踏み出すための羅針盤となるでしょう。

---------------------------------------------------------------

## 1. 関数とは何か？：プログラムを「部品化」する思考法

プログラミングにおける関数とは、**「特定の処理をひとまとまりにした部品」**と定義できます。大規模で複雑なプログラムを開発する際、すべての処理を一つの場所に書き連ねていくのは現実的ではありません。そこで、機能ごとに処理を小さな「部品」として分割し、それぞれに名前を付けて管理します。この「部品化」こそが、関数がもたらす最も戦略的な役割であり、管理しやすいプログラムを構築するための基本的な思考法です。

**関数の主なメリット**

関数を活用することで、プログラム開発において以下の3つの強力な利点が得られます。

* 再利用性 (Reusability) 一度作成した関数（部品）は、プログラム内のどこからでも、何度でも呼び出して使用できます。同じ処理を何度も書く必要がなくなり、コードの重複を排除できます。これにより、開発効率が飛躍的に向上し、プログラム全体の一貫性も保たれます。
* 可読性 (Readability) 処理のまとまりに calculate_sum や print_report といった具体的な名前を付けることで、そのコードブロックが何をしているのか一目で理解できるようになります。これにより、プログラムの全体像が把握しやすくなり、他の開発者がコードを読む際の負担も大幅に軽減されます。
* 保守性 (Maintainability) プログラムの機能に修正や改善が必要になった場合、その機能に対応する関数だけを修正すれば済みます。関連のない他のコードに影響を与えるリスクが低減されるため、バグの発生を抑制し、安全かつ迅速に開発を進めることが可能になります。

関数の概念的な利点を理解したところで、次に、この強力な「部品」を実際にどのように作成し、使用するのかを見ていきましょう。

## 2. 関数の基本構造：定義と呼び出し

関数の概念を実際のコードに落とし込むには、「定義（作ること）」と「呼び出し（使うこと）」という2つの基本操作を理解する必要があります。これらは、関数を扱う上での最も基本的なステップです。

### 2.1. 関数の定義 (Function Definition)

関数を定義する（作成する）際には、以下の3つの要素を指定する必要があります。これらは、コンパイラに関数がどのようなものかを伝えるための設計図の役割を果たします。

1. 戻り値の型（返却値の型） 関数が処理を終えた後、呼び出し元に返すデータの型を指定します。（例: int, float）。もし何も値を返さない場合は、voidという特別なキーワードを使用します。
2. 関数名 その関数がどのような処理を行うのかが明確にわかる、適切な名前を付けます。命名規則は、コードの可読性を左右する重要な要素です。
3. 引数（ひきすう） 関数が処理を行うために、外部（呼び出し元）からデータを受け取るための入り口です。データとその型を指定します。引数が不要な場合は、voidと書くのが「引数がない」ことを明示する良い習慣ですが、括弧内を空()にすることも許されています。

これらの要素を組み合わせた、具体的な関数の定義例を見てみましょう。

```
// 関数の定義例
// 2つのint型整数を受け取り、その合計をint型で返す関数
int add(int a, int b) {
  int sum = a + b;
  return sum;
}
```

### 2.2. 関数の呼び出し (Function Call)

定義した関数をプログラム内で実際に使用するプロセスが「呼び出し」です。呼び出しは、**「関数名」を指定し、必要であれば括弧内に「引数」**として渡す値を記述することで行います。これにより、プログラムの制御がその関数に移り、定義された処理が実行されます。

先ほど定義したadd関数をmain関数から呼び出す例は以下の通りです。

```
// 関数の呼び出し例
int main() {
  int result = add(5, 3); // add関数を呼び出し、戻り値を変数resultに格納
  // この時点で、変数resultには8が格納される
  return 0;
}
```

### 2.3. 値を返さない関数

すべての関数が値を返すわけではありません。画面にメッセージを表示する、ファイルにデータを書き込むなど、特定の操作を実行するだけで完結する処理もあります。このような場合、戻り値の型としてキーワードvoidを指定することで、値を返さない関数を作成できます。

```
// 値を返さない関数例
void hello(int num) {
  printf("Num is %d\n", num);
}
```

さて、C言語ではコードが上から順にコンパイルされるという特性があります。この特性が、関数の配置にどのような影響を与えるのか、そしてその解決策である「プロトタイプ宣言」について次に見ていきましょう。

## 3. 関数のプロトタイプ宣言：コンパイラとの約束

C言語のコンパイラは、ソースコードを上から下へ順番に読み込んで解釈します。そのため、ある関数を呼び出す時点で、その関数がどのような形をしているかをコンパイラが知らなければエラーが発生します。特に、main関数の後に関数を定義する場合、この問題が顕著になります。

この問題を解決するための仕組みがプロトタイプ宣言です。これは、関数本体の定義より先に、**「関数の形（戻り値の型、関数名、引数）だけをあらかじめコンパイラに知らせておくための宣言」** です。いわば、コンパイラに対して「これからこういう形の関数が登場しますよ」と事前に予告しておく「約束」のようなものです。これにより、コンパイラは関数の定義が後から出てきても、呼び出し時点でその存在を正しく認識できるようになります。

```
// 関数のプロトタイプ宣言
// 2つのint型整数を受け取り、int型を返す関数
int add(int a, int b)
```

関数の構造を理解したところで、次はその内外で使われる「変数」がどのように振る舞うのか、その有効範囲（スコープ）について掘り下げていきます。

## 4. 変数の有効範囲：ローカル変数 vs グローバル変数

変数がプログラム内のどこからアクセスできるか、その有効範囲を**「スコープ」**と呼びます。スコープの概念を理解することは、関数の独立性を保ち、プログラム全体の安全性を確保する上で極めて重要です。変数のスコープは、主に「ローカル変数」と「グローバル変数」の2種類に大別されます。

### 4.1. ローカル変数 (Local Variable)

ローカル変数は、特定の関数やブロック（{}で囲まれた範囲）の中でのみ有効な変数です。その特徴は以下の通りです。

* 宣言場所: 関数の中や、for文・if文などのブロック（{}）の中で宣言されます。
* 有効範囲: 宣言された関数内、またはブロック内でのみアクセス可能です。範囲外からアクセスしようとするとコンパイルエラーになります。
* 生存期間: その関数やブロックの実行が開始されると生成され、実行が終了すると同時に消滅します。
* 初期値: 明示的に初期化しない場合、その値は**不定（ごみデータ）**となります。

### 4.2. グローバル変数 (Global Variable)

グローバル変数は、プログラム全体を通してどこからでもアクセスできる変数です。その特徴は以下の通りです。

* 宣言場所: すべての関数の外側（通常はファイルの先頭近く）で宣言されます。
* 有効範囲: プログラム内のどの関数からでもアクセス、読み取り、書き込みが可能です。
* 生存期間: プログラムの実行開始と同時に生成され、プログラムが終了するまでメモリ上に存続します。
* 初期値: 明示的に初期化しない場合、自動的に0に初期化されます。

### 4.3. 比較と実践的なアドバイス

ローカル変数とグローバル変数の主な違いを以下の表にまとめます。

|特徴|ローカル変数|グローバル変数|
|---|---|---|
|有効範囲|宣言した 関数内 または ブロック内 のみ|プログラム全体（すべての関数）|
|宣言場所|関数やブロックの 中|すべての関数の 外|
|生存期間|関数やブロックの終了と共に 消滅|プログラムの終了まで 存続|
|初期値|初期化しないと 不定（ごみ）|初期化しないと自動的に0|

**💡 アドバイス**

初心者のうちは、原則としてグローバル変数の利用は避け、ローカル変数を使用することを強く推奨します。グローバル変数はプログラムのどこからでも値を変更できてしまうため、**「どこで値が変わったのか追跡するのが難しくなり、予期せぬバグの原因になりやすい」**という重大なリスクを伴います。データの受け渡しは、関数の引数と戻り値を使って明示的に行うのが安全なプログラミングの基本です。

これまでに学んだ知識は、効果的な関数を設計するための重要な要素です。最後に、これらの知識を総括し、実践的なスキルとして定着させるためのベストプラクティスを確認しましょう。

---------------------------------------------------------------

6. まとめ：優れた関数設計のためのベストプラクティス

本研修資料では、関数の基本概念である「部品化」から始まり、定義と呼び出し、プロトタイプ宣言、そして変数のスコープまで、C言語における関数の核心を解説してきました。これらはすべて、高品質なソフトウェアを構築するための基礎となります。

プログラムを学び始めた皆さんが、常に意識すべき、実践的な指針を以下にまとめます。

* 部品化の意識 複雑な処理は、一つの巨大な塊として実装するのではなく、積極的に意味のある単位で関数に分割してください。これにより、コードの可読性と保守性が劇的に向上します。
* スコープの原則 原則として変数はローカル変数として宣言してください。グローバル変数の使用は、意図せぬ副作用（バグ）の温床となるため、その必要性を慎重に検討し、使用を最小限に留めるべきです。

関数を自在に使いこなすことは、単にコードが書けるというレベルを超え、質の高いソフトウェアを論理的に設計するための第一歩です。ここで学んだ知識を土台とし、今後の更なる学習と実践に励んでください。
